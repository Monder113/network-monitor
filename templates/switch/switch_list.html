{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="fw-bold">Switch Devices</h1>
    <a href="{% url 'switch_add' %}" class="btn btn-success">
        <i class="bi bi-plus-circle"></i> Add a Switch
    </a>
</div>

<div class="card shadow-sm">
    <div class="card-body p-0">
        <table class="table table-hover table-striped align-middle mb-0">
            <thead class="table-dark">
                <tr>
                    <th>Name</th>
                    <th>IP Adress</th>
                    <th>Vendor</th>
                    <th>Model</th>
                    <th>Status</th>
                    <th>Last Seen</th>
                </tr>
            </thead>
            <tbody id="switch-table">
                {% include 'switch/partials/switch_table.html' %}
            </tbody>
        </table>
    </div>
</div>

<script>
    const socket = new WebSocket(
        'ws://' + window.location.host + '/ws/switch_updates/'
    );

    socket.onopen = function(e) {
        console.log("‚úÖ WebSocket is connected.");
    };

    socket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        console.log("üì° Gelen veri:", data);

        const row = document.getElementById('switch-row-' + data.id);
        if (row) {
            row.innerHTML = data.html;

            // Animasyon efekti
            row.classList.add("table-success");
            setTimeout(() => row.classList.remove("table-success"), 1500);
        }
    };

    socket.onclose = function(e) {
        console.error("‚ùå WebSocket is closed.");
    };
</script>
{% endblock %}
